<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galactic Security Core</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; overflow: hidden; color: white; font-family: sans-serif; }
        canvas { display: block; }
        .security-overlay {
            position: fixed; inset: 0; background: #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999; text-align: center;
        }
    </style>
</head>
<body>

    <!-- KEY DE SEGURIDAD ORIGINAL -->
    <!-- Si modificas el valor de data-key o borras este div, el sistema lo detectará -->
    <div id="vault-key-system" data-key="RK-809-PRO-SECURITY-99"></div>

    <!-- Pantalla de bloqueo -->
    <div id="blocker" class="security-overlay hidden">
        <div class="p-8 border-2 border-red-600 bg-red-900/20 rounded-3xl max-w-md">
            <h1 class="text-3xl font-black text-red-500 mb-4">SEGURIDAD VIOLADA</h1>
            <p id="error-text" class="text-lg font-bold text-white mb-6">
                Juego HTML sin key seguridad anulada, no puedes jugarlo.
            </p>
            <div class="text-[10px] mono text-red-400 uppercase tracking-widest opacity-50">
                System integrity check failed
            </div>
        </div>
    </div>

    <!-- UI del Juego -->
    <div id="ui" class="fixed top-5 left-5 z-10">
        <p class="text-xs font-black text-green-500 uppercase tracking-widest">Nivel de Integridad: OK</p>
        <p class="text-2xl font-black">SCORE: <span id="score">0</span></p>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        (function() {
            // Configuración del sistema
            const KEY_ID = "vault-key-system";
            const STORAGE_INTEGRITY_KEY = "system_integrity_seal";
            const REQUIRED_KEY_VALUE = "RK-809-PRO-SECURITY-99";

            const blocker = document.getElementById('blocker');
            const errorDisplay = document.getElementById('error-text');
            const keyElement = document.getElementById(KEY_ID);

            function validateIntegrity() {
                // 1. Verificar si el elemento existe
                if (!keyElement) {
                    fail("Juego HTML sin key seguridad anulada, no puedes jugarlo.");
                    return false;
                }

                // 2. Verificar si el valor de la key es el correcto
                const currentKey = keyElement.getAttribute('data-key');
                if (currentKey !== REQUIRED_KEY_VALUE) {
                    fail("Key de seguridad modificada o inválida. Acceso denegado.");
                    return false;
                }

                // 3. Comparar con el sello guardado en LocalStorage
                // Esto detecta si el usuario intentó cambiar la key en el código original
                const savedSeal = localStorage.getItem(STORAGE_INTEGRITY_KEY);
                
                if (!savedSeal) {
                    // Primera ejecución: Guardamos el sello
                    localStorage.setItem(STORAGE_INTEGRITY_KEY, btoa(REQUIRED_KEY_VALUE));
                } else if (savedSeal !== btoa(REQUIRED_KEY_VALUE)) {
                    fail("Se detectó manipulación del archivo fuente. Juego bloqueado.");
                    return false;
                }

                return true;
            }

            function fail(msg) {
                blocker.classList.remove('hidden');
                errorDisplay.innerText = msg;
                // Detener cualquier ejecución posterior
                throw new Error("Security Violation: " + msg);
            }

            // Ejecutar validación antes de iniciar el juego
            window.onload = () => {
                if (validateIntegrity()) {
                    startGame();
                }
            };
        })();

        // --- LÓGICA DEL JUEGO ---
        function startGame() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreEl = document.getElementById('score');

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            let score = 0;
            const stars = Array.from({length: 100}, () => ({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                s: Math.random() * 2
            }));

            function draw() {
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Estrellas
                ctx.fillStyle = '#fff';
                stars.forEach(s => {
                    ctx.fillRect(s.x, s.y, s.s, s.s);
                    s.y += s.s * 0.5;
                    if(s.y > canvas.height) s.y = 0;
                });

                // Jugador (Círculo simple que sigue al mouse)
                ctx.beginPath();
                ctx.arc(mouseX, mouseY, 15, 0, Math.PI * 2);
                ctx.fillStyle = '#00f0ff';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                score++;
                scoreEl.innerText = Math.floor(score/10);
                requestAnimationFrame(draw);
            }

            let mouseX = canvas.width / 2;
            let mouseY = canvas.height / 2;

            window.addEventListener('mousemove', e => {
                mouseX = e.clientX;
                mouseY = e.clientY;
            });

            draw();
        }
    </script>
</body>
</html>

