<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VaultStore - Local Storage Persistence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;700;900&display=swap');
        
        :root {
            --primary: #3b82f6;
            --bg-dark: #070708;
            --card-bg: #111114;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: #e2e8f0;
            overflow-x: hidden;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        .glass-card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #222;
            border-radius: 10px;
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(59, 130, 246, 0.03);
        }
    </style>
</head>
<body class="custom-scrollbar">

    <!-- Navegaci√≥n -->
    <nav class="sticky top-0 z-50 bg-black/60 backdrop-blur-xl border-b border-white/5 p-4">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="showView('store')">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center font-black text-white shadow-lg shadow-blue-600/30">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                </div>
                <span class="text-xl font-black tracking-tighter uppercase italic tracking-widest">Vault<span class="text-blue-500">Local</span></span>
            </div>
            <div class="flex gap-3">
                <button onclick="showView('store')" class="px-5 py-2 rounded-xl text-sm font-bold hover:bg-white/5 transition text-slate-400 hover:text-white">Tienda</button>
                <button onclick="showView('upload')" class="px-5 py-2 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-500 transition shadow-lg shadow-blue-600/20">Subir APK</button>
                <button onclick="showView('dev')" class="px-5 py-2 border border-white/10 rounded-xl text-sm font-bold text-slate-500 hover:text-blue-400 hover:border-blue-400/50 transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>
                    Dev
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-6">
        
        <!-- VISTA: TIENDA -->
        <section id="view-store" class="view-section space-y-8 animate-in fade-in duration-500">
            <div class="flex justify-between items-end">
                <div>
                    <h1 class="text-4xl font-black uppercase italic tracking-tighter text-white">Librer√≠a Local</h1>
                    <p class="text-slate-500 text-sm mt-1">Archivos guardados en el almacenamiento de tu navegador.</p>
                </div>
                <button onclick="clearStore()" class="text-[10px] text-red-500/50 hover:text-red-500 uppercase font-bold tracking-widest transition">Limpiar Memoria</button>
            </div>
            
            <div id="app-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Apps rendered here -->
            </div>

            <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 text-slate-600">
                <svg class="w-16 h-16 mb-4 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/></svg>
                <p class="font-bold uppercase tracking-widest text-xs">No hay aplicaciones guardadas</p>
                <button onclick="showView('upload')" class="mt-4 text-blue-500 text-xs hover:underline">Sube tu primera app ahora</button>
            </div>
        </section>

        <!-- VISTA: SUBIR -->
        <section id="view-upload" class="view-section hidden py-10 animate-in slide-in-from-bottom-5">
            <div class="max-w-xl mx-auto glass-card rounded-[2.5rem] p-10">
                <h2 class="text-2xl font-black mb-2 uppercase tracking-tight italic text-white">Subida Certificada</h2>
                <p class="text-slate-500 text-sm mb-8">Usa la llave din√°mica del Panel Dev para autorizar la persistencia del archivo.</p>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-[10px] font-black text-blue-500 uppercase tracking-widest mb-2">Validation Key (50 chars)</label>
                        <input type="text" id="input-key" placeholder="Pega la llave aqu√≠..." class="w-full bg-black border border-white/5 rounded-2xl py-4 px-5 text-sm mono text-blue-400 focus:outline-none focus:border-blue-500/50 transition-all">
                    </div>

                    <div class="upload-area rounded-2xl p-8 text-center relative">
                        <input type="file" id="file-input" class="absolute inset-0 opacity-0 cursor-pointer" onchange="updateFileInfo()">
                        <div id="file-info-ui">
                            <svg class="w-10 h-10 text-slate-700 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                            <p class="text-sm font-bold text-slate-400">Seleccionar archivo APK</p>
                            <p class="text-[10px] text-slate-600 mt-1 uppercase">M√°ximo recomendado: 2MB (L√≠mite LocalStorage)</p>
                        </div>
                    </div>

                    <button id="btn-publish" onclick="processUpload()" class="w-full py-5 bg-white text-black font-black rounded-2xl hover:bg-blue-600 hover:text-white transition-all uppercase text-sm tracking-widest">Validar y Guardar</button>
                    
                    <div id="upload-msg" class="hidden p-4 rounded-xl text-xs font-bold border text-center"></div>
                </div>
            </div>
        </section>

        <!-- VISTA: DEV -->
        <section id="view-dev" class="view-section hidden py-10">
            <div id="dev-login" class="max-w-md mx-auto glass-card rounded-[2.5rem] p-12 text-center">
                <h2 class="text-3xl font-black mb-8 uppercase italic text-white tracking-tighter">Acceso Dev</h2>
                <input type="password" id="dev-pass" placeholder="Password" class="w-full bg-black border border-white/5 rounded-2xl py-4 px-6 mb-4 focus:outline-none focus:border-blue-500 text-center mono shadow-inner">
                <button onclick="checkDevPass()" class="w-full py-4 bg-blue-600 text-white font-black rounded-2xl hover:bg-blue-500 transition-all uppercase text-sm shadow-xl shadow-blue-600/20">Desbloquear Llaves</button>
                <p id="dev-error" class="text-red-500 text-[10px] font-bold mt-4 uppercase hidden tracking-widest">Acceso Denegado</p>
            </div>

            <div id="dev-panel" class="max-w-xl mx-auto glass-card rounded-[2.5rem] p-10 hidden border-blue-500/20 border-2 relative">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-xl font-black uppercase italic text-white">Dynamic Session Key</h2>
                    <span id="timer-display" class="bg-blue-600/20 text-blue-400 px-3 py-1 rounded-full text-xs font-bold mono">05:00</span>
                </div>
                <div class="p-6 bg-black rounded-2xl border border-white/5 mb-6 relative group">
                    <p id="current-key-display" class="mono text-xs text-blue-400 break-all leading-relaxed tracking-tighter opacity-80"></p>
                    <button onclick="copyKey()" class="mt-4 w-full py-2 bg-white/5 hover:bg-white/10 rounded-lg text-[10px] font-bold uppercase tracking-widest transition">Copiar Llave</button>
                </div>
                <button onclick="generateKey()" class="w-full py-3 text-blue-500 text-[10px] font-black uppercase tracking-widest hover:text-blue-400 transition">Regenerar Manualmente</button>
                <button onclick="logoutDev()" class="w-full mt-10 text-slate-600 text-[10px] uppercase font-bold hover:text-white transition">Cerrar Sesi√≥n</button>
            </div>
        </section>

    </main>

    <script>
        // --- CONSTANTES ---
        const MASTER_PASS = "JHGg";
        const STORAGE_KEY = "VAULT_LOCAL_APPS";

        // --- ESTADO ---
        let currentKey = "";
        let timeLeft = 300;
        let timerInterval = null;
        let apps = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

        // --- NAVEGACI√ìN ---
        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            if(viewId === 'store') renderApps();
            if(viewId === 'upload') resetUploadForm();
        }

        // --- L√ìGICA DE KEYS ---
        function generateKey() {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%&*";
            let key = "";
            for (let i = 0; i < 50; i++) key += chars.charAt(Math.floor(Math.random() * chars.length));
            currentKey = key;
            document.getElementById('current-key-display').innerText = key;
            timeLeft = 300;
            clearInterval(timerInterval);
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const display = document.getElementById('timer-display');
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    currentKey = "";
                    document.getElementById('current-key-display').innerText = "SESSION_EXPIRED_REGENERATE";
                    display.innerText = "00:00";
                    display.className = "bg-red-500/20 text-red-400 px-3 py-1 rounded-full text-xs font-bold mono";
                } else {
                    const m = Math.floor(timeLeft / 60);
                    const s = timeLeft % 60;
                    display.innerText = `${m}:${s.toString().padStart(2, '0')}`;
                    display.className = "bg-blue-600/20 text-blue-400 px-3 py-1 rounded-full text-xs font-bold mono";
                }
            }, 1000);
        }

        function copyKey() {
            if(!currentKey) return;
            navigator.clipboard.writeText(currentKey);
            const btn = event.target;
            const original = btn.innerText;
            btn.innerText = "¬°COPIADO!";
            setTimeout(() => btn.innerText = original, 1000);
        }

        // --- ACCESO DEV ---
        function checkDevPass() {
            if (document.getElementById('dev-pass').value === MASTER_PASS) {
                document.getElementById('dev-login').classList.add('hidden');
                document.getElementById('dev-panel').classList.remove('hidden');
                if (!currentKey) generateKey();
            } else {
                const err = document.getElementById('dev-error');
                err.classList.remove('hidden');
                setTimeout(() => err.classList.add('hidden'), 2000);
            }
        }

        function logoutDev() {
            document.getElementById('dev-pass').value = "";
            document.getElementById('dev-login').classList.remove('hidden');
            document.getElementById('dev-panel').classList.add('hidden');
        }

        // --- MANEJO DE ARCHIVOS ---
        function updateFileInfo() {
            const input = document.getElementById('file-input');
            const info = document.getElementById('file-info-ui');
            if(input.files[0]) {
                info.innerHTML = `
                    <div class="text-blue-500 font-bold text-sm">${input.files[0].name}</div>
                    <div class="text-[10px] text-slate-500 mt-1 uppercase">${(input.files[0].size / 1024).toFixed(1)} KB</div>
                `;
            }
        }

        function resetUploadForm() {
            document.getElementById('input-key').value = "";
            document.getElementById('file-input').value = "";
            document.getElementById('upload-msg').classList.add('hidden');
            document.getElementById('file-info-ui').innerHTML = `
                <svg class="w-10 h-10 text-slate-700 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                <p class="text-sm font-bold text-slate-400">Seleccionar archivo APK</p>
                <p class="text-[10px] text-slate-600 mt-1 uppercase">M√°ximo recomendado: 2MB</p>
            `;
        }

        async function processUpload() {
            const userKey = document.getElementById('input-key').value;
            const fileInput = document.getElementById('file-input');
            const msg = document.getElementById('upload-msg');
            const btn = document.getElementById('btn-publish');

            msg.classList.remove('hidden', 'bg-red-500/10', 'text-red-400', 'bg-green-500/10', 'text-green-400');

            if (userKey !== currentKey || !currentKey) {
                msg.innerText = "ERROR: LLAVE DE SESI√ìN NO V√ÅLIDA";
                msg.classList.add('bg-red-500/10', 'text-red-400', 'border-red-500/20', 'hidden');
                msg.classList.remove('hidden');
                return;
            }

            if (!fileInput.files[0]) {
                msg.innerText = "ERROR: NO HAY ARCHIVO SELECCIONADO";
                msg.classList.add('bg-red-500/10', 'text-red-400', 'border-red-500/20');
                msg.classList.remove('hidden');
                return;
            }

            const file = fileInput.files[0];
            
            // Simular carga y procesar Base64
            btn.disabled = true;
            btn.innerText = "PROCESANDO BINARIOS...";
            
            try {
                const base64 = await toBase64(file);
                const newApp = {
                    id: Date.now(),
                    name: file.name.replace(/\.[^/.]+$/, "").replace(/\s+/g, "_"),
                    fileName: file.name,
                    size: (file.size / 1024).toFixed(1) + " KB",
                    data: base64,
                    date: new Date().toLocaleDateString()
                };

                apps.unshift(newApp);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(apps));
                
                msg.innerText = "¬°SINCRONIZACI√ìN EXITOSA! APK GUARDADO EN LOCAL.";
                msg.classList.add('bg-green-500/10', 'text-green-400', 'border-green-500/20');
                msg.classList.remove('hidden');
                
                setTimeout(() => showView('store'), 1500);
            } catch (e) {
                msg.innerText = "ERROR: ESPACIO LOCAL INSUFICIENTE";
                msg.classList.add('bg-red-500/10', 'text-red-400');
                msg.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerText = "Validar y Guardar";
            }
        }

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        // --- RENDERIZADO TIENDA ---
        function renderApps() {
            const grid = document.getElementById('app-grid');
            const empty = document.getElementById('empty-state');
            grid.innerHTML = "";
            
            if (apps.length === 0) {
                empty.classList.remove('hidden');
                return;
            }
            
            empty.classList.add('hidden');
            apps.forEach(app => {
                const card = document.createElement('div');
                card.className = "glass-card p-6 rounded-3xl hover:border-blue-500/40 transition-all group animate-in zoom-in-95 duration-300";
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 bg-white/5 rounded-2xl flex items-center justify-center text-2xl">üì¶</div>
                        <button onclick="deleteApp(${app.id})" class="text-slate-700 hover:text-red-500 transition">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></button>
                        </div>
                    </div>
                    <h3 class="text-white font-bold truncate pr-4" title="${app.fileName}">${app.name}</h3>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="text-[9px] font-black bg-blue-500/10 text-blue-500 px-2 py-0.5 rounded uppercase tracking-widest">${app.size}</span>
                        <span class="text-[9px] text-slate-600 font-bold">${app.date}</span>
                    </div>
                    <button onclick="downloadApp(${app.id})" class="w-full mt-6 py-3 bg-blue-600/10 hover:bg-blue-600 text-blue-500 hover:text-white rounded-xl text-[10px] font-black transition-all border border-blue-500/20 uppercase tracking-[0.2em]">Descargar APK</button>
                `;
                grid.appendChild(card);
            });
        }

        function downloadApp(id) {
            const app = apps.find(a => a.id === id);
            if (!app) return;
            const a = document.createElement('a');
            a.href = app.data;
            a.download = app.fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function deleteApp(id) {
            if(!confirm("¬øEliminar esta aplicaci√≥n de la memoria local?")) return;
            apps = apps.filter(a => a.id !== id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(apps));
            renderApps();
        }

        function clearStore() {
            if(!confirm("¬øBORRAR TODA LA LIBRER√çA? Esto no se puede deshacer.")) return;
            apps = [];
            localStorage.removeItem(STORAGE_KEY);
            renderApps();
        }

        // Iniciar
        renderApps();
    </script>
</body>
</html>

  
